<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.devmatch.mapper.MemberMapper">

    <!-- 회원 등록 -->
    <insert id="insertMember" parameterType="MemberDTO">
        <selectKey keyProperty="memberId" resultType="long" order="BEFORE">
            SELECT dm_member_seq.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO dm_member (
            member_id, email, password, name, member_type, 
            phone, profile_image, provider, provider_id, status,
            created_at, updated_at
        ) VALUES (
            #{memberId}, #{email}, #{password}, #{name}, #{memberType},
            #{phone}, #{profileImage}, #{provider}, #{providerId}, 
            NVL(#{status}, 'ACTIVE'),
            SYSDATE, SYSDATE
        )
    </insert>

    <!-- 회원 조회 (ID) -->
    <select id="selectMemberById" resultType="MemberDTO">
        SELECT 
            member_id, email, password, name, member_type,
            phone, profile_image, provider, provider_id, status,
            created_at, updated_at
        FROM dm_member
        WHERE member_id = #{memberId}
    </select>

    <!-- 회원 조회 (이메일) -->
    <select id="selectMemberByEmail" resultType="MemberDTO">
        SELECT 
            member_id, email, password, name, member_type,
            phone, profile_image, provider, provider_id, status,
            created_at, updated_at
        FROM dm_member
        WHERE email = #{email}
    </select>

    <!-- 회원 조회 (소셜로그인) -->
    <select id="selectMemberByProvider" resultType="MemberDTO">
        SELECT 
            member_id, email, password, name, member_type,
            phone, profile_image, provider, provider_id, status,
            created_at, updated_at
        FROM dm_member
        WHERE provider = #{provider} AND provider_id = #{providerId}
    </select>

    <!-- 회원 목록 (전체) -->
    <select id="selectAllMembers" resultType="MemberDTO">
        SELECT 
            member_id, email, password, name, member_type,
            phone, profile_image, provider, provider_id, status,
            created_at, updated_at
        FROM dm_member
        ORDER BY created_at DESC
    </select>

    <!-- 회원 목록 (유형별) -->
    <select id="selectMembersByType" resultType="MemberDTO">
        SELECT 
            member_id, email, password, name, member_type,
            phone, profile_image, provider, provider_id, status,
            created_at, updated_at
        FROM dm_member
        WHERE member_type = #{memberType}
        ORDER BY created_at DESC
    </select>

    <!-- 회원 정보 수정 -->
    <update id="updateMember" parameterType="MemberDTO">
        UPDATE dm_member SET
            name = #{name},
            phone = #{phone},
            profile_image = #{profileImage},
            updated_at = SYSDATE
        WHERE member_id = #{memberId}
    </update>

    <!-- 회원 상태 변경 -->
    <update id="updateMemberStatus">
        UPDATE dm_member SET
            status = #{status},
            updated_at = SYSDATE
        WHERE member_id = #{memberId}
    </update>

    <!-- 회원 삭제 -->
    <delete id="deleteMember">
        DELETE FROM dm_member WHERE member_id = #{memberId}
    </delete>

    <!-- 이메일 중복 확인 -->
    <select id="countByEmail" resultType="int">
        SELECT COUNT(*) FROM dm_member WHERE email = #{email}
    </select>

</mapper>
